# プロジェクト憲章（Project Charter） 草案

本ドキュメントは、過去のVRChatワールド（Metafes2025など）で培った技術とルールを整理し、今後の新規ワールド制作における「AI（Antigravity）と人間（ユーザー）の共同開発」を円滑かつ統一性のあるものにするための基本方針です。

## 1. バージョン管理（Git運用ルール）
「GitHub Flow + develop」を採用し、安全性を担保しつつシンプルに運用します。
*   **main ブランチ**: 常に安定して動作する（VRChatにアップロード可能な）リリース用ブランチ。作業は行わない。
*   **develop ブランチ**: 開発のクッションとして機能するブランチ。機能統合のベースラインとし、直接の作業は行わない。
*   **topic ブランチ**: 実際の開発・修正を行う作業ブランチ。
    *   **命名規則**: `yymmdd_用途_内容` （例: `240223_feat_gun_system`）
    *   **用途プレフィックス**:
        *   `feat`: 新機能追加
        *   `fix`: バグ修正
        *   `env`: 環境構築（アセット導入など）
        *   `ref`: リファクタリング（機能を変えずにコード整理）

## 2. プロジェクト構造（Unityフォルダ管理）
VRChat SDKやサードパーティ製アセット（BOOTH等）と自作物を明確に分離するため、すべての自作コンテンツは専用フォルダ内に配置します。
*   **配置先**: `Assets/Projects/` の直下
*   **サブフォルダ構成**:
    *   `Components/`: 素材類（Audio, Fonts, Textures, Materials など）を格納。適宜サブフォルダを切る。
    *   `Prefabs/`: 作成したギミックやステージのプレハブを格納。
    *   `Scripts/`: UdonSharpスクリプトを格納。シーン別、またはプレハブごとにフォルダを分けても良い。

## 2.1 プロジェクト構造（プロジェクト全体）
VRChatワールドと、ドキュメントフォルダを分離します。
* `ZombiiDominanceWorld/`：VRChatのワールドデータ。
* `docs/`：ワールドには表示しない、プロジェクト全体の仕様書。ドキュメント作成指示を受けた場合、こちらに作成すること。

## 2.2 ドキュメント管理
ドキュメントは`docs/`に作成する、作成するときのファイル名は原則日本語で行うこと。

## 3. コーディング規約（C# / UdonSharp）
AIによる自動生成の揺らぎを防ぎ、ユーザー主導で読解・修正しやすいコードベースを維持するためのルールです。

### 3.1 命名規則と役割のプレフィックス/サフィックス
*   **クラス名・スクリプト名**: パスカルケース（`PascalCase`）
*   **変数名・メソッド名**: 変数はキャメルケース（`camelCase`）、メソッドはパスカルケース（`PascalCase`）
*   **サフィックス（接尾辞）による役割の明確化**:
    *   `〇〇Manager`: データの保持・全体的な進行を管理するクラス（例: `GameManager`, `ScoreManager`）。
    *   `〇〇Controller`: 能動的な操作や、各オブジェクトの振る舞いを司るクラス（例: `GateController`, `PlayerController`）。
    *   `〇〇Display` または `〇〇UI`: 画面表示（Canvas, TextMeshProなど）のみを処理するクラス。

### 3.2 UdonSharp・ネットワークの統一実装ルール
AI生成特有の「実装方法のばらつき」を防ぐため、以下の設計思想を固定します。
*   **所有権（Ownership）の明示**: プレイヤーのアクションに伴う処理は、必ず `Networking.SetOwner(player, gameObject);` でオーナー権限を取得してから行う。
*   **LINQの不使用（U#制限）**: `using System.Linq;` は使用せず、配列の検索やソートはすべて古典的な `for` または `foreach` ループで実装し、可読性を保つ。
*   **プレイヤーIDの活用**: GameManagerやScoreManagerに見られるように、配列のインデックスとして `player.playerId`（0〜79）を利用し、無駄なループ処理を避ける。
*   **仮実装・TODOの明記**: 実装優先で書き捨てた箇所や、後でユーザーが数値を調整すべき箇所には、コメントとして `【★】` を必ず記述し、可視化する。

## 4. SOLID原則に基づく設計方針
本プロジェクトにおける開発は、保守性と拡張性を高めるため、可能な限りSOLID原則に従います。

### 4.1 適用方針
1.  **単一責任の原則 (SRP)**: 1つのクラス・スクリプトは1つの役割のみを持つ。
    *   *例: 「点数を計算するクラス」と「UIに点数を表示するクラス」は分ける（ScoreManagerとScoreDisplay等）。*
2.  **オープン・クローズドの原則 (OCP)**: 機能追加を修正ではなく「拡張」で行えるようにする。ただし、設計方針として過度な派生を避け、スクリプトの組み合わせで表現する。
3.  **リスコフの置換原則 (LSP) と【継承より委譲】の原則**: 
    *   **本プロジェクトにおける最重要設計ルール:** 仕様変更への耐久性を高めるため、原則として**クラスの継承（`class A : B`）を禁止し、すべて「委譲（Composition / Delegation）」によって機能を組み合わせます。**
    *   *例: 複数の武器を作る場合、「`BaseGun`」を継承するのではなく、共通の「`Gun`」コンポーネントに「`FireLogic`（発射方式）」「`DamageLogic`（ダメージ計算）」などのスクリプトをアタッチ（保有）させ、処理を委譲する。*
4.  **インターフェース分離の原則 (ISP)**: 巨大なインターフェースを作らず、必要な機能ごとに細かく分ける。
5.  **依存性逆転の原則 (DIP)**: 具体的なクラスに直接依存せず、抽象に依存させる。ただし、VRChat環境に合わせて制限と代替案を適用する（後述）。

### 4.2 【重要】既存のUdonSharp/Unityルールとの「衝突」と妥協点
VRChat（UdonSharp）の仕様上、一部のSOLID原則が完全に適用できない、あるいは適用が困難な箇所が存在します。以下の2点は「SOLID原則の例外（衝突箇所）」として扱います。

1.  **DIP（依存性逆転）とISP（インターフェース分離）の制限**:
    *   **衝突の理由**: UdonSharpはC#のインターフェース（`interface`）のサポートが不完全であり、インスペクター（Unityの画面）からの参照割り当てもうまく機能しないケースが多いです。
    *   **妥協案**: インターフェースや共通抽象クラスに依存させる代わりに、Unity特有の「コンポーネント指向（各種UdonBehaviourを持つGameObject）」を活用します。完全に疎結合（DIP）にすることは難しいため、**インスペクターを通じた具体的なスクリプトコンポーネントの直接の割り当て**（委譲先のコンポーネントのD&D）を許容します。
2.  **SRP（単一責任）とネットワーク同期の兼ね合い**:
    *   **衝突の理由**: VRChatでは「ネットワーク同期（[UdonSynced]）」を行う変数は1つのスクリプトにまとめたほうがトラフィックや遅延管理上、安定しやすい傾向があります。
    *   **妥協案**: 同期専用の「データ専用クラス（Manager）」が肥大化しやすいことは許容し、その代わり「描画（UI）」や「物理演算（Controller）」など、同期を伴わないロジックは別のコンポーネント（委譲先）に外出ししてSRPを担保します。

## 5. デバッグと品質保証
*   **デバッグ用UIの活用**: 過去のプロジェクトに存在した `VRCDebugUI` のような、ワールド内でログを確認できるパネルをデフォルトで設置し、Udon開発時のトラブルシューティングを容易にする。
*   **責務の分離 (SRPへの準拠)**: ひとつのスクリプト（特にUdonBehaviour）が1000行を超えるような「神クラス」化を防ぐ。機能ごとにコンポーネントを分割する（例: 銃の発射ロジックと、銃の当たり判定ロジックは別々のスクリプトとする）。

---
**※【検討事項】（ユーザー様へ）**
*   上記の内容でプロジェクト憲章のベースとさせていただいてよろしいでしょうか？
*   「変数名にはプレフィックス（例えばUIなら `txt_Score` のように）を付ける」など、さらに厳密に追加したいルールがあればご教示ください。
